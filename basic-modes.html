<!--
Shows a single child element at a time.

@element basic-modes
-->
<!--
TODO: Contains a polymer-selector rather than inherit from it? This avoids
cases like multi-selection being turned on.
-->

<link rel="import" href="../core-selector/core-selector.html">

<polymer-element name="basic-modes" extends="core-selector">
<template>
  <style>
  :host {
    display: flex;
  }

  polyfill-next-selector {
    content: ':not(.core-selected)';
  }
  ::content :not(.core-selected) {
    display: none;
  }
  </style>
  <shadow></shadow>
</template>

<script>
Polymer( "basic-modes", {

  attached: function() {
    // By default, the first mode is selected.
    if ( !this.selected ) {
      this.selected = 0;
    }
  },

  /*
   * Returns the collection of children, where any children that are content
   * nodes are replaced with the elements distributed (perhaps more than once)
   * to that content element.
   *
   * TODO: Move this to basic-element?
   */
  get distributedChildren() {
    return this._flattenChildren( this.children );
  },

  // Override the basic items property so we can handle (re)distributed content.
  // TODO: Handle selectors, etc., like base class' items can.
  get items() {
    return this.distributedChildren;
  },

  ready: function() {
    this.super();
    this.notap = true;
  },

  /*
   * Given a node, return the children of that element. If any of the children
   * are content elements, instead of returning the content element, return the
   * nodes distributed to it. (Apply this rule recursively.)
   */
  _flattenChildren: function( nodes ) {
    var expanded = Array.prototype.map.call( nodes, function( node ) {
      if ( node instanceof HTMLContentElement ) {
        // content element; use its distributed nodes instead.
        return this._flattenChildren( node.getDistributedNodes() );
      } else if ( node instanceof HTMLElement ) {
        // Plain element; use as is.
        return [ node ];
      } else {
        // Not an element; skip.
        return [];
      }
    }.bind( this ));
    var flattened = Array.prototype.concat.apply( [], expanded );
    return flattened;
  }

});
</script>

</polymer-element>
